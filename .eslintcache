[{"C:\\Users\\Dor\\Dev\\Projects\\React\\Digital-signature\\digital-signature-client\\src\\index.js":"1","C:\\Users\\Dor\\Dev\\Projects\\React\\Digital-signature\\digital-signature-client\\src\\App.js":"2","C:\\Users\\Dor\\Dev\\Projects\\React\\Digital-signature\\digital-signature-client\\src\\reportWebVitals.js":"3","C:\\Users\\Dor\\Dev\\Projects\\React\\Digital-signature\\digital-signature-client\\src\\services\\pdfService.js":"4","C:\\Users\\Dor\\Dev\\Projects\\React\\Digital-signature\\digital-signature-client\\src\\pages\\CreatePdf.js":"5","C:\\Users\\Dor\\Dev\\Projects\\React\\Digital-signature\\digital-signature-client\\src\\pages\\EditPdf.js":"6"},{"size":606,"mtime":1610037454714,"results":"7","hashOfConfig":"8"},{"size":609,"mtime":1610259814635,"results":"9","hashOfConfig":"8"},{"size":362,"mtime":499162500000,"results":"10","hashOfConfig":"8"},{"size":185334,"mtime":1610274018448,"results":"11","hashOfConfig":"8"},{"size":4803,"mtime":1610274552706,"results":"12","hashOfConfig":"8"},{"size":7392,"mtime":1610266963917,"results":"13","hashOfConfig":"8"},{"filePath":"14","messages":"15","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"16"},"1s3u3wg",{"filePath":"17","messages":"18","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"16"},{"filePath":"19","messages":"20","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"16"},{"filePath":"21","messages":"22","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"23","messages":"24","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"25","messages":"26","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":1,"source":"27","usedDeprecatedRules":"16"},"C:\\Users\\Dor\\Dev\\Projects\\React\\Digital-signature\\digital-signature-client\\src\\index.js",[],["28","29"],"C:\\Users\\Dor\\Dev\\Projects\\React\\Digital-signature\\digital-signature-client\\src\\App.js",[],"C:\\Users\\Dor\\Dev\\Projects\\React\\Digital-signature\\digital-signature-client\\src\\reportWebVitals.js",[],"C:\\Users\\Dor\\Dev\\Projects\\React\\Digital-signature\\digital-signature-client\\src\\services\\pdfService.js",["30"],"C:\\Users\\Dor\\Dev\\Projects\\React\\Digital-signature\\digital-signature-client\\src\\pages\\CreatePdf.js",["31"],"C:\\Users\\Dor\\Dev\\Projects\\React\\Digital-signature\\digital-signature-client\\src\\pages\\EditPdf.js",["32","33"],"import React, { useState, useEffect, useRef } from 'react';\r\nimport * as pdfjsLib from 'pdfjs-dist/build/pdf';\r\nimport pdfjsWorker from 'pdfjs-dist/build/pdf.worker.entry';\r\nimport { getPdf, savePdf } from '../services/pdfService';\r\n\r\npdfjsLib.GlobalWorkerOptions.workerSrc = pdfjsWorker;\r\n\r\nlet ctx;\r\nlet page;\r\nlet renderCtx;\r\n\r\nconst initialStyle = {\r\n    left: (window.innerWidth - 85) + 'px',\r\n    top: (window.innerHeight - 245) + 'px',\r\n    width: 80 + 'px',\r\n    height: 240 + 'px',\r\n}\r\n\r\nexport const EditPdf = (props) => {\r\n    const pdfId = props.match.params.id;\r\n    const loadedPdf = useRef();\r\n    const canvasRef = useRef();\r\n\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [isEditMode, setIsEditMode] = useState(false);\r\n    const [navPosition, setNavPosition] = useState(initialStyle);\r\n    const [isPdfEdited, setIsPdfEdited] = useState();\r\n\r\n\r\n    useEffect(() => {\r\n        window.visualViewport.addEventListener(\"resize\", viewportHandler);\r\n        window.visualViewport.addEventListener(\"scroll\", viewportHandler);\r\n\r\n        return (() => {\r\n            window.visualViewport.removeEventListener(\"resize\", viewportHandler);\r\n            window.visualViewport.removeEventListener(\"scroll\", viewportHandler);\r\n        })\r\n    }, [])\r\n\r\n    const viewportHandler = (e) => {\r\n        const style = {\r\n            left: (e.target.width + e.target.offsetLeft - 85 * (1 / e.target.scale)) + 'px',\r\n            top: (e.target.height + e.target.offsetTop - 245 * (1 / e.target.scale)) + 'px',\r\n            width: 80 * (1 / e.target.scale) + 'px',\r\n            height: 240 * (1 / e.target.scale) + 'px',\r\n        }\r\n        setNavPosition(style);\r\n    }\r\n\r\n    useEffect(() => {\r\n        ctx = canvasRef.current.getContext('2d', { desynchronized: true });\r\n        onGetPdf();\r\n    }, [canvasRef])\r\n\r\n\r\n\r\n    async function onGetPdf() {\r\n        setIsLoading(true);\r\n        loadedPdf.current = await getPdf(pdfId);\r\n        if (!loadedPdf.current) return;\r\n        setIsPdfEdited(loadedPdf.current.edited);\r\n        onRenderCtx(loadedPdf.current.data);\r\n        setIsLoading(false);\r\n    }\r\n\r\n    async function onRenderCtx(data) {\r\n        if (!loadedPdf.current.edited) {\r\n            const doc = await pdfjsLib.getDocument(data).promise;\r\n            page = await doc.getPage(1);\r\n            const viewport = await page.getViewport({ scale: 2 });\r\n            canvasRef.current.height = viewport.height;\r\n            canvasRef.current.width = viewport.width;\r\n            renderCtx = {\r\n                canvasContext: ctx,\r\n                viewport\r\n            }\r\n            await page.render(renderCtx).promise;\r\n\r\n        } else {\r\n            const img = new Image;\r\n            img.onload = () => {\r\n                canvasRef.current.height = img.height;\r\n                canvasRef.current.width = img.width;\r\n                ctx.drawImage(img, 0, 0);\r\n            }\r\n            img.src = data;\r\n        }\r\n    }\r\n\r\n    function onToggleEditMode() {\r\n        if (!loadedPdf.current.edited) setIsEditMode((prev) => !prev);\r\n    }\r\n\r\n    function handleMouseDraw(e) {\r\n        if (e.nativeEvent.which !== 1 || !isEditMode) return;\r\n        const offsetX = e.nativeEvent.offsetX;\r\n        const offsetY = e.nativeEvent.offsetY;\r\n        draw(offsetX, offsetY);\r\n    }\r\n\r\n    function handleTouchDraw(e) {\r\n        if (e.touches.length !== 1 || !isEditMode) return;\r\n        var x = e.touches[0].clientX - e.touches[0].target.offsetLeft;\r\n        var y = e.touches[0].clientY - e.touches[0].target.offsetTop;\r\n        draw(x, y);\r\n    }\r\n\r\n    function draw(x, y) {\r\n        ctx.lineWidth = 5;\r\n        ctx.lineCap = 'round';\r\n        ctx.lineTo(x, y);\r\n        ctx.stroke();\r\n    }\r\n\r\n    function finishPosition() {\r\n        if (!isEditMode) return;\r\n        ctx.beginPath();\r\n    }\r\n\r\n    async function clearCanvas() {\r\n        if (!page || loadedPdf.current.edited) return;\r\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n        await page.render(renderCtx).promise;\r\n    }\r\n\r\n\r\n    async function onUpdatePdf() {\r\n        if (!loadedPdf.current) return;\r\n        const data = canvasRef.current.toDataURL(\"image/png\");\r\n        setIsLoading(true);\r\n        setIsEditMode(false);\r\n        const updatedPdf = await savePdf({ ...loadedPdf.current, data });\r\n        loadedPdf.current = updatedPdf;\r\n        if (!loadedPdf.current) return;\r\n        setIsPdfEdited(loadedPdf.current.edited);\r\n        onRenderCtx(loadedPdf.current.data);\r\n        setIsLoading(false);\r\n\r\n\r\n        // function dataURLtoFile(dataurl, filename) {\r\n        //     let arr = dataurl.split(','),\r\n        //         mime = arr[0].match(/:(.*?);/)[1],\r\n        //         bstr = atob(arr[1]),\r\n        //         n = bstr.length,\r\n        //         u8arr = new Uint8Array(n);\r\n        //     console.log(u8arr);\r\n        //     while (n--) {\r\n        //         u8arr[n] = bstr.charCodeAt(n);\r\n        //     }\r\n        //     console.log(u8arr);\r\n        //     return new File([u8arr], filename, { type: mime });\r\n        // }\r\n\r\n\r\n        // const file = dataURLtoFile(data, fileName + '.png');\r\n        // console.log(file);\r\n        // const filesArray = [file];\r\n\r\n        // if (navigator.share) {\r\n        //     navigator.share({\r\n        //         files: filesArray,\r\n        //         text: fileName,\r\n        //     })\r\n        //         .then(() => console.log('Share was successful.'))\r\n        //         .catch((error) => console.log('Sharing failed', error));\r\n        // } else {\r\n        //     console.log(`Your system doesn't support sharing files.`);\r\n        // }\r\n\r\n    }\r\n\r\n    function onDownloadPdf() {\r\n        const fileName = (loadedPdf?.current?.name || 'קבלה') + '.png';\r\n        const a = document.createElement('a');\r\n        a.href = canvasRef.current.toDataURL();\r\n        a.download = fileName;\r\n        a.click();\r\n    }\r\n\r\n    return (\r\n        <div className=\"edit-pdf-container\">\r\n            <div className=\"nav-wrapper\" style={navPosition && { ...navPosition }}>\r\n                <div className={`actions flex column ${(isPdfEdited || isLoading) ? 'justify-end' : 'space-between'}`}>\r\n                    <button className={`edit ${isEditMode ? 'active' : ''}`} onClick={onToggleEditMode} hidden={isPdfEdited || isLoading} />\r\n                    <button className=\"reset\" onClick={clearCanvas} hidden={isPdfEdited || isLoading} />\r\n                    {!isPdfEdited ?\r\n                        <button className={`done ${isLoading ? 'loading' : ''}`} onClick={onUpdatePdf} /> :\r\n                        <>\r\n                            <div className=\"saved-successfuly flex align-center justify-center\" ><p style={{ fontSize: navPosition.width }}>נשמר בהצלחה!</p></div>\r\n                            <button className=\"download\" onClick={onDownloadPdf} />\r\n                        </>}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"canvas-container\">\r\n                <canvas ref={canvasRef} className=\"pdf-canvas\" onMouseDown={handleMouseDraw} onMouseMove={handleMouseDraw}\r\n                    onMouseUp={finishPosition} onTouchStart={handleTouchDraw} onTouchMove={handleTouchDraw}\r\n                    onTouchEnd={finishPosition} style={{ touchAction: isEditMode ? 'none' : 'auto' }}></canvas>\r\n            </div>\r\n\r\n        </div>\r\n    );\r\n}\r\n\r\n",{"ruleId":"34","replacedBy":"35"},{"ruleId":"36","replacedBy":"37"},{"ruleId":"38","severity":1,"message":"39","line":17,"column":5,"nodeType":"40","messageId":"41","endLine":19,"endColumn":55},{"ruleId":"42","severity":1,"message":"43","line":65,"column":8,"nodeType":"44","endLine":65,"endColumn":14,"suggestions":"45"},{"ruleId":"42","severity":1,"message":"46","line":53,"column":8,"nodeType":"44","endLine":53,"endColumn":19,"suggestions":"47"},{"ruleId":"48","severity":1,"message":"49","line":80,"column":25,"nodeType":"50","messageId":"51","endLine":80,"endColumn":34,"fix":"52"},"no-native-reassign",["53"],"no-negated-in-lhs",["54"],"no-unreachable","Unreachable code.","ReturnStatement","unreachableCode","react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: 'phoneNumber'. Either include it or remove the dependency array.","ArrayExpression",["55"],"React Hook useEffect has a missing dependency: 'onGetPdf'. Either include it or remove the dependency array.",["56"],"new-parens","Missing '()' invoking a constructor.","NewExpression","missing",{"range":"57","text":"58"},"no-global-assign","no-unsafe-negation",{"desc":"59","fix":"60"},{"desc":"61","fix":"62"},[2708,2708],"()","Update the dependencies array to be: [link, phoneNumber]",{"range":"63","text":"64"},"Update the dependencies array to be: [canvasRef, onGetPdf]",{"range":"65","text":"66"},[2488,2494],"[link, phoneNumber]",[1819,1830],"[canvasRef, onGetPdf]"]